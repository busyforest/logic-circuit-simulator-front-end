<h2>Canvas</h2>

<div class="canvas" (drop)="dropFromOutside($event)" (dragover)="allowDrop($event)">

  <!-- SVG 连接线图层 -->
  <svg class="connection-layer" width="600" height="400">
    <defs>
      <marker id="arrowhead" markerWidth="10" markerHeight="7"
              refX="10" refY="3.5" orient="auto" markerUnits="strokeWidth">
        <polygon points="0 0, 10 3.5, 0 7" fill="black" />
      </marker>
    </defs>

    <path *ngFor="let path of connectionPaths"
          [attr.d]="path.d"
          stroke="black"
          fill="none"
          stroke-width="2"
          marker-end="url(#arrowhead)" />
  </svg>

  <!-- 元件图层 -->
  <div
    *ngFor="let gate of canvasGates"
    cdkDrag
    [cdkDragFreeDragPosition]="{x: gate.x || 0, y: gate.y || 0}"
    [cdkDragBoundary]="'.canvas'"
    (cdkDragStarted)="onDragStarted($event, gate)"
    (cdkDragMoved)="onDragMoved($event, gate)"
    (cdkDragEnded)="onDragEnd($event, gate)"
    (contextmenu)="onRightClick($event, gate)"
    (dblclick)="onDoubleClick($event, gate)"
    (click)="onGateClick(gate)"
    [ngStyle]="{
      'z-index': gate.z || 1,
      'border-color': selectedGates.includes(gate) ? 'red' : '#1b5e20'
    }"
    class="canvas-gate"
  >
    {{ gate.name }}

    <!-- 真值表区域 -->
    <div *ngIf="gate.showTruthTable" class="truth-table-popup">
      <table>
        <tr *ngFor="let row of getTruthTable(gate)">
          <td *ngFor="let cell of row">{{ cell }}</td>
        </tr>
      </table>
    </div>

  </div>
</div>

<!-- 按钮容器放画布下方 -->
<div class="button-container">
  <button (click)="startConnect()">连接</button>
  <button (click)="startDisconnect()">断开连接</button>
</div>
